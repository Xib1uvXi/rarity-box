package contractlib

import (
	"github.com/ethereum/go-ethereum/ethclient"
	"github.com/stretchr/testify/assert"
	"os"
	"testing"
)

func TestNewCallerLib(t *testing.T) {
	pk := os.Getenv("FTMPK")
	if pk == "" {
		t.Skip("pk is empty")
	}

	client, err := ethclient.Dial("https://rpc.ftm.tools")
	assert.NoError(t, err)

	clib, err := BuildV1CallerLib(pk, client, false)
	assert.NoError(t, err)

	assert.NoError(t, clib.Adventure([]uint64{2062009, 2063971, 2222628}))
}

func TestNewCallerLib_Dungeon(t *testing.T) {
	pk := os.Getenv("FTMPK")
	if pk == "" {
		t.Skip("pk is empty")
	}

	client, err := ethclient.Dial("https://rpc.ftm.tools")
	assert.NoError(t, err)

	clib, err := BuildV1CallerLib(pk, client, false)
	assert.NoError(t, err)

	assert.NoError(t, clib.Dungeon([]uint64{3574968,3575125,3575147,3575169,3575116,3575100,3575124,3575138,3575164,3575003,3575142,3575139,3575163,3575154,3575171,3575170,3574992,3575181,3575180,3575197,3575182,3574924,3575191,3574983,3575187,3575099,3575128,3575111,3575103,3575198,3574947,3575275,3575281,3575199,3575282,3574949,3575280,3575324,3575146,3575338,3575118,3575276,3575329,3574927,3575333,3574979,3575341,3575347,3575327,3575179,3575360,3575355,3575335,3575362,3575368,3575365,3575372,3575029,3575369,3575350,3575364,3575374,3575107,3575380,3575377,3575378,3575386,3575387,3575393,3575409,3575403,3575394,3575417,3575410,3575420,3575391,3575463,3575470,3575476,3575477,3575319,3575204,3575271,3575486,3575478,3575200,3575469,3575482,3575487,3575342,3575361,3575494,3575375,3575518,3575503,3575523,3575535,3575530,3575519,3575351,3575385,3575547,3575510,3575504,3575490,3575534,3575546,3575549,3575554,3575400,3575373,3575376,3575483,3575572,3575570,3575579,3575565,3575638,3575580,3575642,3575636,3575581,3575647,3575538,3575553,3575653,3575658,3575569,3575646,3575650,3575661,3575657,3575670,3575679,3575660,3575675,3575659,3575674,3575665,3575666,3575676,3575664,3575680,3575682,3575686,3575651,3575687,3575381,3575713,3575688,3575712,3575706,3575499,3575714,3575745,3575667,3575719,3575509,3575722,3575739,3575757,3575765,3575491,3575766,3575771,3575654,3575705,3575542,3575746,3575526,3575564,3575795,3575704,3575779,3575812,3575804,3575813,3575809,3575824,3575789,3575825,3575671,3575799,3575835,3575814,3575834,3575839,3575841,3575758,3575840,3575764,3575851,3575901,3575656,3575908,3575894,3575907,3575904,3575796,3575558,3575915,3575850,3575652,3575923,3575802,3575856,3575703,3575945,3575864,3575950,3575943,3575742,3575909,3575797,3575752,3575808,3575803,3575928,3575938,3575944,3575756,3575702,3575845,3575922,3575810,3575826,3575936,3575846,3575914}))
}

func TestCallerLib_needApproved(t *testing.T) {
	//ids := []uint64{3575281}
	ids := []uint64{2896819,2895831,2896812,2896822,2841525,2796906,2895835,3574921,2895834,2222628,2895808,2896820,3574912,2896808,2896813,2896823,2895832,3574917,2062009,2895807,2896821,2841517,2895827,3574915,2896815,2895828,3574913,2896805,3574906,2895822,3574930,3574940,3574986,3574929,3574962,3574931,3574941,2895815,3574932,3574973,3574971,3574965,3574996,3575012,3574957,3574975,3574993,3574999,3574958,3574936,3575018,3575028,3575027,3575093,3575092,2887688,3574953,3575004,3574981,3575134,3574968,3575125,3575147,3575169,3575116,3575100,3575124,3575138,3575164,3575003,3575142,3575139,3575163,3575154,3575171,3575170,3574992,3575181,3575180,3575197,3575182,3574924,3575191,3574983,3575187,3575099,3575128,3575111,3575103,3575198,3574947,3575275,3575281,3575199,3575282,3574949,3575280,3575324,3575146,3575338,3575118,3575276,3575329,3574927,3575333,3574979,3575341,3575347,3575327,3575179,3575360,3575355,3575335,3575362,3575368,3575365,3575372,3575029,3575369,3575350,3575364,3575374,3575107,3575380,3575377,3575378,3575386,3575387,3575393,3575409,3575403,3575394,3575417,3575410,3575420,3575391,3575463,3575470,3575476,3575477,3575319,3575204,3575271,3575486,3575478,3575200,3575469,3575482,3575487,3575342,3575361,3575494,3575375,3575518,3575503,3575523,3575535,3575530,3575519,3575351,3575385,3575547,3575510,3575504,3575490,3575534,3575546,3575549,3575554,3575400,3575373,3575376,3575483,3575572,3575570,3575579,3575565,3575638,3575580,3575642,3575636,3575581,3575647,3575538,3575553,3575653,3575658,3575569,3575646,3575650,3575661,3575657,3575670,3575679,3575660,3575675,3575659,3575674,3575665,3575666,3575676,3575664,3575680,3575682,3575686,3575651,3575687,3575381,3575713,3575688,3575712,3575706,3575499,3575714,3575745,3575667,3575719,3575509,3575722,3575739,3575757,3575765,3575491,3575766,3575771,3575654,3575705,3575542,3575746,3575526,3575564,3575795,3575704,3575779,3575812,3575804,3575813,3575809,3575824,3575789,3575825,3575671,3575799,3575835,3575814,3575834,3575839,3575841,3575758,3575840,3575764,3575851,3575901,3575656,3575908,3575894,3575907,3575904,3575796,3575558,3575915,3575850,3575652,3575923,3575802,3575856,3575703,3575945,3575864,3575950,3575943,3575742,3575909,3575797,3575752,3575808,3575803,3575928,3575938,3575944,3575756,3575702,3575845,3575922,3575810,3575826,3575936,3575846,3575914}

	pk := os.Getenv("FTMPK")
	if pk == "" {
		t.Skip("pk is empty")
	}

	client, err := ethclient.Dial("https://rpc.ftm.tools")
	assert.NoError(t, err)

	clib, err := BuildV1CallerLib(pk, client, false)
	assert.NoError(t, err)

	tids := clib.convertUint2BigInt(ids)

	_, err = clib.needApproved(tids)
	//_, err = clib.name(tids)
	assert.NoError(t, err)
}